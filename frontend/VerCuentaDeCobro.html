<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Poppins"
    />
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <script
      src="https://kit.fontawesome.com/64d58efce2.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.js"></script>

    <title>Ver cuenta de cobro</title>
  </head>

  <body>
    <div class="grid-container">
      <div class="grid-item-menu">
        <p></p>
        <a href="Index.html">
          <p>HOME</p>
        </a>
        <p></p>
        <a href="IngresarSolicitud.html">
          <p>INGRESAR SOLICITUD</p>
        </a>
        <div class="selected">VER CUENTA DE COBRO</div>
        <a href="VerOrdenDeServicio.html">
          <p>VER ORDEN DE SERVICIO</p>
        </a>
        <a href="IngresarProveedor.html">
          <p>INGRESAR PROVEEDOR</p>
        </a>
        <a href="IngresarCliente.html">
          <p>INGRESAR CLIENTE</p>
        </a>
        <a href="IngresarSponsor.html">
          <p>INGRESAR SPONSOR</p>
        </a>
        <a href="IngresarTarifas.html">
          <p>INGRESAR TARIFAS</p>
        </a>
        <a href="IngresarServicios.html">
          <p>INGRESAR SERVICIOS</p>
        </a>
        <a href="VerProveedores.html">
          <p>VER PROVEEDORES</p>
        </a>
        <a href="VerClientes.html">
          <p>VER CLIENTES</p>
        </a>
        <a href="VerTarifas.html">
          <p>VER TARIFAS</p>
        </a>
        <a href="Comparar.html">
          <p>COMPARAR</p>
        </a>
        <p></p>
        <p>SALIR</p>
      </div>

      <div class="grid-item">
        <h1 id="title" class="titleContent">VER CUENTA DE COBRO</h1>
        <div class="cuentas">
          <div class="form-text">Proveedor</div>
          <div class="form-text">Fecha</div>
          <div class="cuentas-select-field">
            <i class="fas fa-user"></i>
            <select name="proveedor" id="proveedor" onchange="traerCuenta()">
              <option
                value="Seleccione proveedor"
                style="color: #aaa; font-weight: 500"
              >
                Seleccione proveedor
              </option>
            </select>
          </div>
          <div class="cuentas-select-field">
            <i class="far fa-calendar"></i>
            <select name="fecha" id="fecha" onchange="traerCuenta()">
              <option
                value="Seleccione un mes"
                style="color: #aaa; font-weight: 500"
              >
                Seleccione un mes
              </option>
              <option value="1">Enero</option>
              <option value="2">Febrero</option>
              <option value="3">Marzo</option>
              <option value="4">Abril</option>
              <option value="5">Mayo</option>
              <option value="6">Junio</option>
              <option value="7">Julio</option>
              <option value="8">Agosto</option>
              <option value="9">Septiembre</option>
              <option value="10">Octubre</option>
              <option value="11">Noviembre</option>
              <option value="12">Diciembre</option>
            </select>
          </div>
        </div>
        <iframe src="" frameborder="0" id="iframe"></iframe>
      </div>
    </div>
    <script>
      fetch("http://localhost:8080//traerNombresProveedores")
        .then((response) => response.json())
        .then((data) => cargarComboBox("proveedor", data));

      function cargarComboBox(tipo, datas) {
        for (var x = 0; x < datas.length; x++)
          agregar(document.getElementById(tipo), datas[x]);
      }

      function agregar(select, val) {
        const option = document.createElement("option");
        const valor = val;
        option.value = valor;
        option.text = valor;
        select.appendChild(option);
      }

      function traerCuenta() {
        const proveedor = document.getElementById("proveedor").value;
        const fecha = document.getElementById("fecha").value;
        if (
          proveedor != "Seleccione proveedor" &&
          fecha != "Seleccione un mes"
        ) {
          var url = "http://localhost:8080//traerNombreCuentaCobro";
          var condicion = {
            proveedor: proveedor,
            fecha: fecha,
          };
          fetch(url, {
            method: "POST",
            body: JSON.stringify(condicion),
            headers: {
              Accept: "application/json",
              "Content-Type": "application/json",
            },
          })
            .then((response) => response.json())
            .then((data) => crearPdf(data));
        } else {
          document.getElementById("iframe").src = "";
        }
      }

      function crearPdf(data) {
        const doc = new jsPDF();

        doc.setFontSize(8);
        doc.setFont("times");
        doc.setFontType("bold");
        doc.text(110, 20, "CUENTA DE COBRO", "center");
        doc.text(
          110,
          30,
          "JOURNEY MARKETING Y NEGOCIOS S.A.S. NIT 901.375.884-1",
          "center"
        );
        doc.setFontType("normal");
        doc.text(110, 35, "DEBE A:", "center");
        doc.setFontType("bold");
        doc.text(110, 38, data.proveedor, "center");
        doc.setFontType("normal");
        doc.text(110, 45, "LA SUMA DE:", "center");
        doc.text(110, 50, data.totalLetra, "center");
        doc.text(190, 50, data.total, "right");
        doc.text(110, 55, "CONCEPTO DE:", "center");
        doc.text(110, 58, data.concepto, "center");
        var today = new Date();
        var dd = today.getDate();
        var dia;
        if (dd == 1) {
          dia = "uno";
        } else if (dd == 2) {
          dia = "dos";
        } else if (dd == 3) {
          dia = "tres";
        } else if (dd == 4) {
          dia = "cuatro";
        } else if (dd == 5) {
          dia = "cinco";
        } else if (dd == 6) {
          dia = "seis";
        } else if (dd == 7) {
          dia = "siete";
        } else if (dd == 8) {
          dia = "ocho";
        } else if (dd == 9) {
          dia = "nueve";
        } else if (dd == 10) {
          dia = "diez";
        } else if (dd == 11) {
          dia = "once";
        } else if (dd == 12) {
          dia = "doce";
        } else if (dd == 13) {
          dia = "trece";
        } else if (dd == 14) {
          dia = "catorce";
        } else if (dd == 15) {
          dia = "quince";
        } else if (dd == 16) {
          dia = "dieciséis";
        } else if (dd == 17) {
          dia = "diecisiete";
        } else if (dd == 18) {
          dia = "dieciocho";
        } else if (dd == 19) {
          dia = "diecinueve";
        } else if (dd == 20) {
          dia = "veinte";
        } else if (dd == 21) {
          dia = "veintiun";
        } else if (dd == 22) {
          dia = "veintidos";
        } else if (dd == 23) {
          dia = "veintitres";
        } else if (dd == 24) {
          dia = "veinticuatro";
        } else if (dd == 25) {
          dia = "veinticinco";
        } else if (dd == 26) {
          dia = "venitiseis";
        } else if (dd == 27) {
          dia = "veintisiete";
        } else if (dd == 28) {
          dia = "veintiocho";
        } else if (dd == 29) {
          dia = "veintinueve";
        } else if (dd == 30) {
          dia = "treinta";
        } else if (dd == 31) {
          dia = "treinta y uno";
        }

        doc.text(
          15,
          65,
          "Se entrega a los " +
            dia +
            " (" +
            dd +
            ") días del mes de octubre de 2021."
        );
        var columns = ["Fecha", "Nombre", "Valor"];
        doc.autoTable(columns, data.solicitudes, {
          margin: { top: 70 },
          styles: { fontSize: 8 },
        });

        const posicion = 70 + data.length * 10;
        doc.text(15, posicion, "Cordialmente,");
        doc.setFontType("bold");
        doc.text(15, posicion + 5, "Sandra Milena Castellanos Carrillo");
        doc.setFontType("normal");
        doc.text(15, posicion + 8, "C.C. 52.989.909");
        doc.text(15, posicion + 11, "Teléfono 317 661 9521");

        const objectUrl = doc.output("bloburl");
        document.getElementById("iframe").src = objectUrl;
      }
    </script>
  </body>
</html>
